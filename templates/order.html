<!doctype html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="/static/css/style.css">
    </head>

    <body>

        <div class="center-element">
            <img src="/static/items/{{ item }}.jpg" alt="Coke" height="260px">
            <div class="pricing">
                <h2>PRICE: {{ price }} BCH ($1)</h2>
                <img src="/static/qr.png" alt="QR code payment" height="180px">
            </div>
            <br>
            <a href="/">
                <button class="cancel">CANCEL ORDER</button>
            </a>
        </div>

        <!-- Check the payment -->
        <script src="static/js/jquery.js"></script>
        <script>

            var balance;

            $.ajax({
             url: 'https://rest.bitbox.earth/v1/address/details/bitcoincash%3Aqzrcvjpplnpa6qq2dtcshmke4yl9ngdwfcyfan5vtc',
            }).done(function (data) {
             balance = data.unconfirmedBalance + data.balance;
             console.log(balance);
            });

            function verify_payment() {
                $.getJSON("https://rest.bitbox.earth/v1/address/details/bitcoincash%3Aqzrcvjpplnpa6qq2dtcshmke4yl9ngdwfcyfan5vtc",
                    function(data){
                        var new_balance = data.unconfirmedBalance + data.balance;
                        console.log(new_balance);
                        // we allow a 5% margin with the price
                        if (new_balance > balance + {{ exact_price - exact_price * 0.05 }}) {
                            window.location = "/{{Â item }}/paid";
                    }
                });
            }

            window.setInterval(function(){
                verify_payment();
            }, 2000); // checks every 2 seconds

        </script>

    </body>
</html>